<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Administrativo â€“ Brivax</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg,#f4f4f4,#eaeaea);
      display:flex;flex-direction:column;align-items:center;
      padding:20px;margin:0;
      color:#333;
    }
    .container {
      background:#fff;
      border-radius:12px;
      padding:20px;
      box-shadow:0 6px 12px rgba(0,0,0,0.15);
      width:100%;
      max-width:900px;
    }
    h1 {
      color:#ff6600;
      text-align:center;
      margin-bottom:20px;
    }
    .actions {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      margin-bottom:15px;
    }
    .actions input {
      flex:1;
      min-width:200px;
      padding:8px;
      border-radius:6px;
      border:1px solid #ccc;
      font-size:14px;
    }
    .actions button {
      background:#ff6600;
      border:none;
      color:white;
      padding:10px 15px;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      transition:0.3s;
    }
    .actions button:hover { background:#e65c00; }
    table {
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }
    th,td {
      border-bottom:1px solid #ddd;
      padding:8px;
      text-align:center;
    }
    th { background:#ff6600; color:#fff; position:sticky; top:0; }
    tr:hover { background:#f9f9f9; }
    button.action {
      background:#ff6600;border:none;color:#fff;
      padding:5px 10px;border-radius:6px;
      cursor:pointer;font-size:12px;margin:2px;
    }
    button.action:hover { background:#e65c00; }
    .logout {
      margin-top:20px;background:#555;color:white;
      border:none;padding:10px 20px;border-radius:8px;
      cursor:pointer;transition:0.3s;width:100%;max-width:300px;
    }
    .logout:hover { background:#333; }

    /* Modal estilo */
    .modal {
      display:none;position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.5);align-items:center;justify-content:center;
    }
    .modal-content {
      background:white;padding:20px;border-radius:10px;
      width:90%;max-width:360px;text-align:center;
    }
    .modal-content input,select {
      width:90%;padding:8px;margin:5px 0;
      border-radius:6px;border:1px solid #ccc;font-size:14px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>ðŸ”’ Painel Administrativo</h1>
    <div class="actions">
      <input type="text" id="search" placeholder="Buscar usuÃ¡rio..." oninput="filtrarUsuarios()">
      <button onclick="abrirModal()">âž• Adicionar</button>
      <button onclick="baixarDoGithub()">ðŸ”½ Baixar</button>
      <button onclick="enviarParaGithub()">ðŸ”¼ Enviar</button>
    </div>

    <div style="overflow-x:auto;">
      <table id="usersTable">
        <thead>
          <tr>
            <th>Nome</th><th>Sobrenome</th><th>UsuÃ¡rio</th>
            <th>Celular</th><th>Tipo</th><th>AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <button class="logout" onclick="logout()">Sair</button>
  </div>

  <div class="modal" id="userModal">
    <div class="modal-content">
      <h2 id="modalTitle">Novo UsuÃ¡rio</h2>
      <input id="nome" placeholder="Nome">
      <input id="sobrenome" placeholder="Sobrenome">
      <input id="celular" placeholder="Celular">
      <input id="username" placeholder="UsuÃ¡rio">
      <input id="senha" type="password" placeholder="Senha">
      <select id="tipo">
        <option value="usuario">UsuÃ¡rio</option>
        <option value="admin">Administrador</option>
      </select>
      <button onclick="salvarUsuario()">Salvar</button>
      <button style="background:#777;margin-top:8px;" onclick="fecharModal()">Cancelar</button>
    </div>
  </div>

  <script>
    let editIndex = null;

    const GITHUB_JSON_URL = "https://raw.githubusercontent.com/GuedesShooter/Laudo-Brivax/refs/heads/main/brivaxUsers.json";
    const GITHUB_TOKEN = "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"; // âš ï¸ Mantenha local
    const REPO = "GuedesShooter/Laudo-Brivax";
    const PATH = "brivaxUsers.json";

    async function baixarDoGithub(auto=false){
      try{
        const resp=await fetch(GITHUB_JSON_URL+"?t="+Date.now());
        const data=await resp.json();
        localStorage.setItem("brivaxUsers",JSON.stringify(data));
        carregarUsuarios();
        if(!auto)alert("âœ… Banco atualizado!");
        else console.log("AutoSync: banco atualizado");
      }catch(e){console.error(e);if(!auto)alert("âŒ Erro ao baixar.");}
    }

    async function enviarParaGithub(){
      const users=JSON.parse(localStorage.getItem("brivaxUsers"))||[];
      const content=btoa(JSON.stringify(users,null,2));
      try{
        const get=await fetch(`https://api.github.com/repos/${REPO}/contents/${PATH}`);
        const file=await get.json();const sha=file.sha;
        const resp=await fetch(`https://api.github.com/repos/${REPO}/contents/${PATH}`,{
          method:"PUT",
          headers:{"Authorization":`token ${GITHUB_TOKEN}`,"Content-Type":"application/json"},
          body:JSON.stringify({message:"Atualizando banco Brivax",content,sha})
        });
        if(resp.ok)alert("âœ… Banco enviado!");
        else alert("âŒ Falha ao enviar.");
      }catch(e){console.error(e);alert("âŒ Erro de conexÃ£o.");}
    }

    function carregarUsuarios(){
      const users=JSON.parse(localStorage.getItem("brivaxUsers"))||[];
      const tbody=document.querySelector("#usersTable tbody");
      tbody.innerHTML="";
      users.forEach((u,i)=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${u.nome}</td><td>${u.sobrenome}</td>
          <td>${u.username}</td><td>${u.celular||'-'}</td>
          <td>${u.tipo||'usuario'}</td>
          <td>${u.username!=='ADM'
            ? `<button class='action' onclick='editarUsuario(${i})'>Editar</button>
               <button class='action' onclick='excluirUsuario(${i})'>Excluir</button>`
            : 'â€”'}</td>`;
        tbody.appendChild(tr);
      });
    }

    function abrirModal(){editIndex=null;document.getElementById('userModal').style.display='flex';}
    function fecharModal(){document.getElementById('userModal').style.display='none';}

    function salvarUsuario(){
      const nome=nomeInput.value.trim(),sobrenome=sobrenomeInput.value.trim(),
            celular=celularInput.value.trim(),username=usernameInput.value.trim().toUpperCase().replace(/\s+/g,''),
            senha=senhaInput.value.trim(),tipo=tipoSelect.value;
      if(!nome||!sobrenome||!username||!senha){alert("Preencha todos os campos!");return;}
      let users=JSON.parse(localStorage.getItem('brivaxUsers'))||[];
      if(editIndex===null){
        if(users.some(u=>u.username===username)){alert("UsuÃ¡rio jÃ¡ existe!");return;}
        users.push({nome,sobrenome,celular,username,password:senha,tipo});
      }else users[editIndex]={nome,sobrenome,celular,username,password:senha,tipo};
      localStorage.setItem('brivaxUsers',JSON.stringify(users));
      fecharModal();carregarUsuarios();alert("âœ… UsuÃ¡rio salvo!");
    }

    function editarUsuario(i){
      const u=JSON.parse(localStorage.getItem('brivaxUsers'))[i];
      editIndex=i;
      document.getElementById('userModal').style.display='flex';
      nomeInput.value=u.nome;sobrenomeInput.value=u.sobrenome;celularInput.value=u.celular;
      usernameInput.value=u.username;senhaInput.value=u.password;tipoSelect.value=u.tipo||'usuario';
    }

    function excluirUsuario(i){
      const users=JSON.parse(localStorage.getItem('brivaxUsers'))||[];
      if(users[i].username==='ADM'){alert("NÃ£o pode excluir o ADM.");return;}
      if(confirm(`Excluir usuÃ¡rio "${users[i].username}"?`)){
        users.splice(i,1);localStorage.setItem('brivaxUsers',JSON.stringify(users));carregarUsuarios();
      }
    }

    function filtrarUsuarios(){
      const termo=document.getElementById('search').value.trim().toUpperCase();
      document.querySelectorAll('#usersTable tbody tr').forEach(l=>{
        l.style.display=l.textContent.toUpperCase().includes(termo)?'':'none';
      });
    }

    function logout(){localStorage.removeItem('brivaxUserLogado');window.location.href="LoginScreen.html";}

    window.onload=function(){
      const user=JSON.parse(localStorage.getItem('brivaxUserLogado'));
      if(!user||user.username!=='ADM'){alert("Acesso restrito.");window.location.href="LoginScreen.html";return;}
      baixarDoGithub(true);carregarUsuarios();
    };
  </script>
</body>
</html>
